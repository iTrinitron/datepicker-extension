"use strict";var Module=angular.module("datePicker",[]);Module.constant("datePickerConfig",{template:"/etc/designs/site/cc/js/common/angular-dateRangePicker/templates/datepicker.html",view:"month",views:["year","month","date","hours","minutes"],step:5}),Module.filter("time",function(){function a(a){return("0"+a.getHours()).slice(-2)+":"+("0"+a.getMinutes()).slice(-2)}return function(b){return b instanceof Date||(b=new Date(b),!isNaN(b.getTime()))?a(b):void 0}}),Module.directive("datePicker",["datePickerConfig","datePickerUtils",function(a,b){return{require:["?ngModel","^datePickerApp"],template:'<div ng-include="template"></div>',scope:{model:"=datePicker",after:"=?",before:"=?",pid:"="},controller:function(a){},link:function(c,d,e,f){function g(){var a=c.view,d=c.date;switch(a){case"year":c.years=b.getVisibleYears(d);break;case"month":c.months=b.getVisibleMonths(d);break;case"date":c.weekdays=c.weekdays||b.getDaysOfWeek(),c.weeks=b.getVisibleWeeks(d);break;case"hours":c.hours=b.getVisibleHours(d);break;case"minutes":c.minutes=b.getVisibleMinutes(d,l)}}function h(){return"date"!==c.view?c.view:c.date?c.date.getMonth():null}var i=f[0],j=f[1];c.$on("next",function(){c.next()}),c.$on("prev",function(){c.prev()});var k=!1;c.date=new Date(j.getDefaultDate(c.pid)),c.views=a.views.concat(),c.view=e.view||a.view,c.now=new Date,c.template=e.template||a.template;var l=parseInt(e.step||a.step,10),m=!!e.partial;c.views=c.views.slice(c.views.indexOf(e.maxView||"year"),c.views.indexOf(e.minView||"minutes")+1),(1===c.views.length||-1===c.views.indexOf(c.view))&&(c.view=c.views[0]),c.setView=function(a){-1!==c.views.indexOf(a)&&(c.view=a)},c.setDate=function(a,b){if(!e.disabled&&!c.isDisabled(a,b)){c.date=a;var f=c.views[c.views.indexOf(c.view)+1];if(!f||m||c.model){i&&i.$setViewValue(c.date);var h=m?"minutes":c.view;switch(h){case"minutes":c.model.setMinutes(a.getMinutes());case"hours":c.model.setHours(a.getHours());case"date":c.$emit("dateChange",new Date(a)),g();break;case"month":c.model.setMonth(a.getMonth());case"year":c.model.setFullYear(a.getFullYear())}c.$emit("setDate",c.model,c.view)}f&&c.setView(f),f||"true"!==e.autoClose||(d.addClass("hidden"),c.$emit("hidePicker"))}},c.$on("hidePickers",function(){d.addClass("hidden"),c.$emit("hidePicker")}),c.$watch(h,g),c.next=function(a){var b=c.date;switch(a=a||1,c.view){case"year":case"month":b.setFullYear(b.getFullYear()+a);break;case"date":b.setMonth(b.getMonth()+a);break;case"hours":case"minutes":b.setHours(b.getHours()+a)}k=!0,g()},c.prev=function(a){return c.next(-a||-1)},c.isAfter=function(a){return c.after&&b.isAfter(a,c.after)},c.isBefore=function(a){return c.before&&b.isBefore(a,c.before)},c.isSameMonth=function(a){return b.isSameMonth(c.model,a)},c.isSameYear=function(a){return b.isSameYear(c.model,a)},c.isSameDay=function(a){return b.isSameDay(j.getSelectedStartDate(),a)||b.isSameDay(j.getSelectedEndDate(),a)},c.isSameHour=function(a){return b.isSameHour(c.model,a)},c.isSameMinutes=function(a){return b.isSameMinutes(c.model,a)},c.isDisabled=function(a,b){if(j.getStartCal())var c=j.minStartDate,d=j.maxStartDate;else{var c=j.minEndDate,d=j.maxEndDate;if(null!=j.maxEndDateOffset&&null!=j.getMaxEndDate()&&a>j.getMaxEndDate())return!0}return a>d?!0:c>a?!0:a.getMonth()!=b.getMonth()?!0:!1},c.isNow=function(a){var b=!0,d=c.now;switch(c.view){case"minutes":b&=~~(a.getMinutes()/l)===~~(d.getMinutes()/l);case"hours":b&=a.getHours()===d.getHours();case"date":b&=a.getDate()===d.getDate();case"month":b&=a.getMonth()===d.getMonth();case"year":b&=a.getFullYear()===d.getFullYear()}return b}}}}]),angular.module("datePicker").factory("datePickerUtils",function(){var a=function(a,b,c,d,e){return new Date(0|a,0|b,0|c,0|d,0|e)};return{getVisibleMinutes:function(b,c){b=new Date(b||new Date);var d,e,f=b.getFullYear(),g=b.getMonth(),h=b.getDate(),i=b.getUTCHours(),j=[];for(d=0;60>d;d+=c)e=a(f,g,h,i,d),j.push(e);return j},getVisibleWeeks:function(a){a=new Date(a||new Date);var b=a.getMonth(),c=a.getYear();a.setDate(1),0===a.getDay()?a.setDate(-5):a.setDate(a.getDate()-(a.getDay()-1)),1===a.getDate()&&a.setDate(-6);for(var d,e=[];e.length<6&&!(a.getYear()===c&&a.getMonth()>b);)d=this.getDaysOfWeek(a),e.push(d),a.setDate(a.getDate()+7);return e},getVisibleYears:function(b){b=new Date(b||new Date),b.setFullYear(b.getFullYear()-b.getFullYear()%10);for(var c,d=b.getFullYear(),e=[],f=0;12>f;f++)c=a(d),e.push(c),d++;return e},getDaysOfWeek:function(b){b=new Date(b||new Date),b.setDate(b.getDate()-(b.getDay()-1));for(var c,d=b.getFullYear(),e=b.getMonth(),f=b.getDate(),g=[],h=0;7>h;h++)c=a(d,e,f),g.push(c),f++;return g},getVisibleMonths:function(b){b=new Date(b||new Date);for(var c,d=b.getFullYear(),e=[],f=0;12>f;f++)c=a(d,f,1),e.push(c);return e},getVisibleHours:function(b){b=new Date(b||new Date);var c,d,e=b.getFullYear(),f=b.getMonth(),g=b.getDate(),h=[];for(c=0;24>c;c++)d=a(e,f,g,c),h.push(d);return h},isAfter:function(a,b){return a=void 0!==a?new Date(a):a,b=new Date(b),a&&a.getTime()>=b.getTime()},isBefore:function(a,b){return a=void 0!==a?new Date(a):a,b=new Date(b),a.getTime()<=b.getTime()},isSameYear:function(a,b){return a=void 0!==a?new Date(a):a,b=new Date(b),a&&a.getFullYear()===b.getFullYear()},isSameMonth:function(a,b){return a=void 0!==a?new Date(a):a,b=new Date(b),this.isSameYear(a,b)&&a.getMonth()===b.getMonth()},isSameDay:function(a,b){return a=void 0!==a?new Date(a):a,b=new Date(b),this.isSameMonth(a,b)&&a.getDate()===b.getDate()},isSameHour:function(a,b){return a=void 0!==a?new Date(a):a,b=new Date(b),this.isSameDay(a,b)&&a.getHours()===b.getHours()},isSameMinutes:function(a,b){return a=void 0!==a?new Date(a):a,b=new Date(b),this.isSameHour(a,b)&&a.getMinutes()===b.getMinutes()},isValidDate:function(a){return a&&!(a.getTime&&a.getTime()!==a.getTime())}}}),Module.directive("dateRange",function(){return{require:"^datePickerApp",templateUrl:"/etc/designs/site/cc/js/common/angular-dateRangePicker/templates/daterange.html",scope:{start:"=",end:"="},link:function(a,b,c,d){function e(b){d.getStartCal()?a.start=b:a.end=b,d.updateDateRange()}a.next=function(){a.$broadcast("next")},a.prev=function(){a.$broadcast("prev")},a.$on("dateChange",function(a,b){e(b)}),c.$observe("disabled",function(b){a.disableDatePickers=!!b})}}}),Module.directive("dateInput",function(){return{require:"?ngModel",scope:{dateValue:"="},controller:function(a){a.fixDate=function(b){a.dateValue="help"}},link:function(a,b,c,d){}}}),Module.directive("datePickerApp",function(){return{templateUrl:"/etc/designs/site/cc/js/common/angular-dateRangePicker/templates/datepickerapp.html",scope:{formStartDate:"=fromDate",formEndDate:"=toDate",viewMode:"@",dateOutputFormat:"@",startPlaceholderText:"@",endPlaceholderText:"@",minStartDate:"@",maxStartDate:"@",minEndDate:"@",maxEndDate:"@",maxEndDateOffset:"@",maxStartDateOffset:"@"},controller:function(a){function b(a,b){var c=new Date(a);return c.setDate(c.getDate()+parseInt(b)),c}this.startDate=new Date,a.startCal=null,this.startCal=null,a.isOpen=!1,a.viewMode=a.viewMode||"doubleDate","singleDate"==a.viewMode?a.isSingle=!0:a.isSingle=!1,a.startIsFocused=!1,a.endIsFocused=!1,a.dateOutputFormat=a.dateOutputFormat||"MMM DD YYYY",a.startPlaceholderText=a.startPlaceholderText||"",a.endPlaceholderText=a.endPlaceholderText||"",a.$watch("formStartDate",function(b){a.selectedStartDate=new Date(b),console.log("startdate is "+a.formStartDate)}),a.$watch("formEndDate",function(b){a.selectedEndDate=new Date(b)}),this.minStartDate=new Date(a.minStartDate||new Date).setHours(0,0,0,0),this.maxStartDate=new Date(a.maxStartDate).setHours(0,0,0,0),this.minEndDate=new Date(a.minEndDate||new Date).setHours(0,0,0,0),this.maxEndDate=new Date(a.maxEndDate).setHours(0,0,0,0),this.maxEndDateOffset=a.maxEndDateOffset||null;var c=new Array;this.getMaxEndDate=function(){if(null!=a.selectedStartDate){var d=a.selectedStartDate;return null==c[d]&&(c[d]=b(d,this.maxEndDateOffset)),c[d]}return null},a.debug=function(){console.log(a.selectedStartDate),console.log(a.selectedEndDate),console.log(a.visualStartDate),console.log(a.visualEndDate),console.log("---------------------")},this.getSelectedStartDate=function(){return a.selectedStartDate},this.getSelectedEndDate=function(){return a.selectedEndDate},this.updateDateRange=function(){"doubleDate"==a.viewMode?this.closeDateRange():this.closeDateRange()},a.openDateRange=function(){a.isOpen=!0},this.closeDateRange=function(){a.isOpen=!1},this.toggleStartCal=function(){a.startCal=!a.startCal},a.getNextDay=function(a){return b(a,1)},a.setFocus=function(b,c){"start"==b?a.startIsFocused=c:a.endIsFocused=c},a.setStartCal=function(b){a.startCal=b},this.getStartCal=function(){return a.startCal},this.getDefaultDate=function(a){var b=new Date;return 0==a?b:this.getNextMonth(b)},this.getNextMonth=function(a){return 11==a?new Date(a.getFullYear()+1,0,1):new Date(a.getFullYear(),a.getMonth()+1,1)}},link:function(a,b,c){function d(a){return"[object Date]"!==Object.prototype.toString.call(a)||isNaN(a.getTime())?!1:!0}function e(b){var b=moment(b);return b.format(a.dateOutputFormat)}function f(b){var c=moment(b,a.dateOutputFormat,!0);return new Date(c.format())}function g(b){a.selectedStartDate=b,console.log("date*******"+b),d(b)&&(a.formStartDate=b.toISOString()),a.startIsFocused||(d(b)?a.visualStartDate=e(b):a.visualStartDate=""),""!=a.selectedEndDate&&(a.selectedStartDate>a.selectedEndDate||!d(a.selectedEndDate))&&h("")}function h(b){a.selectedEndDate=b,d(b)&&(a.formEndDate=b.toISOString()),a.endIsFocused||(d(b)?a.visualEndDate=e(b):a.visualEndDate=""),""!=a.selectedEndDate&&(a.selectedEndDate<a.selectedStartDate||!d(a.selectedStartDate))&&g("")}a.dateFormat=a.dateFormat||"L",a.calChange=function(b){a.updateDate(b)},a.updateDate=function(b){var c=function(b){a.selectedEndDate=b},e=a.visualEndDate;"start"===b&&(c=function(b){a.selectedStartDate=b},e=a.visualStartDate),a.setFocus(b,!1),null!=e&&(d(f(e))||""==e)&&c(f(e))},a.$watch("selectedStartDate",function(a){null!=a&&g(a)}),a.$watch("selectedEndDate",function(a){null!=a&&h(a)}),a.$on("dateChange2",function(a,b,c){switch(b){case 0:g(c);break;case 1:h(c)}})}}});var PRISTINE_CLASS="ng-pristine",DIRTY_CLASS="ng-dirty";Module.constant("dateTimeConfig",{template:function(a){return'<div date-picker="'+a.ngModel+'" '+(a.view?'view="'+a.view+'" ':"")+(a.maxView?'max-view="'+a.maxView+'" ':"")+(a.autoClose?'auto-close="'+a.autoClose+'" ':"")+(a.template?'template="'+a.template+'" ':"")+(a.minView?'min-view="'+a.minView+'" ':"")+(a.partial?'partial="'+a.partial+'" ':"")+(a.step?'step="'+a.step+'" ':"")+'class="date-picker-date-time"></div>'},format:"yyyy-MM-dd HH:mm",views:["date","year","month","hours","minutes"],dismiss:!1,position:"relative"}),Module.directive("dateTimeAppend",function(){return{link:function(a,b){b.bind("click",function(a){console.log("e is: "+a),b.find("input")[0].focus()})}}}),Module.directive("dateTime",["$compile","$document","$filter","dateTimeConfig","$parse","datePickerUtils",function(a,b,c,d,e,f){var g=b.find("body"),h=c("date");return{require:"ngModel",scope:!0,link:function(b,c,i,j){function k(a){return h(a,p)}function l(){return j.$modelValue}function m(a){a.stopPropagation(),j.$pristine&&(j.$dirty=!0,j.$pristine=!1,c.removeClass(PRISTINE_CLASS).addClass(DIRTY_CLASS),q&&q.$setDirty(),j.$render())}function n(){v&&(v.remove(),v=null),x&&(x.remove(),x=null)}function o(){if(!v){if(v=a(A)(b),b.$digest(),b.$on("setDate",function(a,b,c){m(a),u&&r[r.length-1]===c&&n()}),b.$on("hidePicker",function(){c.triggerHandler("blur")}),b.$on("$destroy",n),"absolute"===w){var d=angular.extend(c.offset(),{height:c[0].offsetHeight});v.css({top:d.top+d.height,left:d.left,display:"block",position:w}),g.append(v)}else x=angular.element("<div date-picker-wrapper></div>"),c[0].parentElement.insertBefore(x[0],c[0]),x.append(v),v.css({top:c[0].offsetHeight+"px",display:"block"});v.bind("mousedown",function(a){a.preventDefault()})}}var p=i.format||d.format,q=c.inheritedData("$formController"),r=e(i.views)(b)||d.views.concat(),s=i.view||r[0],t=r.indexOf(s),u=i.dismiss?e(i.dismiss)(b):d.dismiss,v=null,w=i.position||d.position,x=null;if(-1===t&&r.splice(t,1),r.unshift(s),j.$formatters.push(k),j.$parsers.unshift(l),angular.isDefined(i.minDate)){var y;j.$validators.min=function(a){return!f.isValidDate(a)||angular.isUndefined(y)||a>=y},i.$observe("minDate",function(a){y=new Date(a),j.$validate()})}if(angular.isDefined(i.maxDate)){var z;j.$validators.max=function(a){return!f.isValidDate(a)||angular.isUndefined(z)||z>=a},i.$observe("maxDate",function(a){z=new Date(a),j.$validate()})}var A=d.template(i);c.bind("focus",o),c.bind("blur",n)}}}]);